// Horton is a Density Functional Theory program.
// Copyright (C) 2011-2012 Toon Verstraelen <Toon.Verstraelen@UGent.be>
//
// This file is part of Horton.
//
// Horton is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 3
// of the License, or (at your option) any later version.
//
// Horton is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, see <http://www.gnu.org/licenses/>
//
//--


#include <stdexcept>
#include "common.h"
#include "cartpure.h"


typedef struct {
    int ipure, icart;
    double x;
} type_sparse_el;


const static type_sparse_el cptf0[] = {
    { 0,  0, 1.0},
};
const static type_sparse_el cptf1[] = {
    { 0,  2, 1.0},
    { 1,  0, 1.0},
    { 2,  1, 1.0},
};
const static type_sparse_el cptf2[] = {
    { 0,  0, -0.5},
    { 0,  3, -0.5},
    { 0,  5, 1.0},
    { 1,  2, 1.0},
    { 2,  4, 1.0},
    { 3,  0, 0.86602540378443864676},
    { 3,  3, -0.86602540378443864676},
    { 4,  1, 1.0},
};
const static type_sparse_el cptf3[] = {
    { 0,  2, -0.67082039324993690892},
    { 0,  7, -0.67082039324993690892},
    { 0,  9, 1.0},
    { 1,  0, -0.61237243569579452455},
    { 1,  3, -0.27386127875258305673},
    { 1,  5, 1.0954451150103322269},
    { 2,  1, -0.27386127875258305673},
    { 2,  6, -0.61237243569579452455},
    { 2,  8, 1.0954451150103322269},
    { 3,  2, 0.86602540378443864676},
    { 3,  7, -0.86602540378443864676},
    { 4,  4, 1.0},
    { 5,  0, 0.790569415042094833},
    { 5,  3, -1.0606601717798212866},
    { 6,  1, 1.0606601717798212866},
    { 6,  6, -0.790569415042094833},
};
const static type_sparse_el cptf4[] = {
    { 0,  0, 0.375},
    { 0,  3, 0.21957751641341996535},
    { 0,  5, -0.87831006565367986142},
    { 0, 10, 0.375},
    { 0, 12, -0.87831006565367986142},
    { 0, 14, 1.0},
    { 1,  2, -0.89642145700079522998},
    { 1,  7, -0.40089186286863657703},
    { 1,  9, 1.19522860933439364},
    { 2,  4, -0.40089186286863657703},
    { 2, 11, -0.89642145700079522998},
    { 2, 13, 1.19522860933439364},
    { 3,  0, -0.5590169943749474241},
    { 3,  5, 0.9819805060619657157},
    { 3, 10, 0.5590169943749474241},
    { 3, 12, -0.9819805060619657157},
    { 4,  1, -0.42257712736425828875},
    { 4,  6, -0.42257712736425828875},
    { 4,  8, 1.1338934190276816816},
    { 5,  2, 0.790569415042094833},
    { 5,  7, -1.0606601717798212866},
    { 6,  4, 1.0606601717798212866},
    { 6, 11, -0.790569415042094833},
    { 7,  0, 0.73950997288745200532},
    { 7,  3, -1.2990381056766579701},
    { 7, 10, 0.73950997288745200532},
    { 8,  1, 1.1180339887498948482},
    { 8,  6, -1.1180339887498948482},
};
const static type_sparse_el cptf5[] = {
    { 0,  2, 0.625},
    { 0,  7, 0.36596252735569994226},
    { 0,  9, -1.0910894511799619063},
    { 0, 16, 0.625},
    { 0, 18, -1.0910894511799619063},
    { 0, 20, 1.0},
    { 1,  0, 0.48412291827592711065},
    { 1,  3, 0.21128856368212914438},
    { 1,  5, -1.2677313820927748663},
    { 1, 10, 0.16137430609197570355},
    { 1, 12, -0.56694670951384084082},
    { 1, 14, 1.2909944487358056284},
    { 2,  1, 0.16137430609197570355},
    { 2,  6, 0.21128856368212914438},
    { 2,  8, -0.56694670951384084082},
    { 2, 15, 0.48412291827592711065},
    { 2, 17, -1.2677313820927748663},
    { 2, 19, 1.2909944487358056284},
    { 3,  2, -0.85391256382996653193},
    { 3,  9, 1.1180339887498948482},
    { 3, 16, 0.85391256382996653193},
    { 3, 18, -1.1180339887498948482},
    { 4,  4, -0.6454972243679028142},
    { 4, 11, -0.6454972243679028142},
    { 4, 13, 1.2909944487358056284},
    { 5,  0, -0.52291251658379721749},
    { 5,  3, 0.22821773229381921394},
    { 5,  5, 0.91287092917527685576},
    { 5, 10, 0.52291251658379721749},
    { 5, 12, -1.2247448713915890491},
    { 6,  1, -0.52291251658379721749},
    { 6,  6, -0.22821773229381921394},
    { 6,  8, 1.2247448713915890491},
    { 6, 15, 0.52291251658379721749},
    { 6, 17, -0.91287092917527685576},
    { 7,  2, 0.73950997288745200532},
    { 7,  7, -1.2990381056766579701},
    { 7, 16, 0.73950997288745200532},
    { 8,  4, 1.1180339887498948482},
    { 8, 11, -1.1180339887498948482},
    { 9,  0, 0.7015607600201140098},
    { 9,  3, -1.5309310892394863114},
    { 9, 10, 1.169267933366856683},
    {10,  1, 1.169267933366856683},
    {10,  6, -1.5309310892394863114},
    {10, 15, 0.7015607600201140098},
};
const static type_sparse_el cptf6[] = {
    { 0,  0, -0.3125},
    { 0,  3, -0.16319780245846672329},
    { 0,  5, 0.97918681475080033975},
    { 0, 10, -0.16319780245846672329},
    { 0, 12, 0.57335309036732873772},
    { 0, 14, -1.3055824196677337863},
    { 0, 21, -0.3125},
    { 0, 23, 0.97918681475080033975},
    { 0, 25, -1.3055824196677337863},
    { 0, 27, 1.0},
    { 1,  2, 0.86356159963469679725},
    { 1,  7, 0.37688918072220452831},
    { 1,  9, -1.6854996561581052156},
    { 1, 16, 0.28785386654489893242},
    { 1, 18, -0.75377836144440905662},
    { 1, 20, 1.3816985594155148756},
    { 2,  4, 0.28785386654489893242},
    { 2, 11, 0.37688918072220452831},
    { 2, 13, -0.75377836144440905662},
    { 2, 22, 0.86356159963469679725},
    { 2, 24, -1.6854996561581052156},
    { 2, 26, 1.3816985594155148756},
    { 3,  0, 0.45285552331841995543},
    { 3,  3, 0.078832027985861408788},
    { 3,  5, -1.2613124477737825406},
    { 3, 10, -0.078832027985861408788},
    { 3, 14, 1.2613124477737825406},
    { 3, 21, -0.45285552331841995543},
    { 3, 23, 1.2613124477737825406},
    { 3, 25, -1.2613124477737825406},
    { 4,  1, 0.27308215547040717681},
    { 4,  6, 0.26650089544451304287},
    { 4,  8, -0.95346258924559231545},
    { 4, 15, 0.27308215547040717681},
    { 4, 17, -0.95346258924559231545},
    { 4, 19, 1.4564381625088382763},
    { 5,  2, -0.81924646641122153043},
    { 5,  7, 0.35754847096709711829},
    { 5,  9, 1.0660035817780521715},
    { 5, 16, 0.81924646641122153043},
    { 5, 18, -1.4301938838683884732},
    { 6,  4, -0.81924646641122153043},
    { 6, 11, -0.35754847096709711829},
    { 6, 13, 1.4301938838683884732},
    { 6, 22, 0.81924646641122153043},
    { 6, 24, -1.0660035817780521715},
    { 7,  0, -0.49607837082461073572},
    { 7,  3, 0.43178079981734839863},
    { 7,  5, 0.86356159963469679725},
    { 7, 10, 0.43178079981734839863},
    { 7, 12, -1.5169496905422946941},
    { 7, 21, -0.49607837082461073572},
    { 7, 23, 0.86356159963469679725},
    { 8,  1, -0.59829302641309923139},
    { 8,  8, 1.3055824196677337863},
    { 8, 15, 0.59829302641309923139},
    { 8, 17, -1.3055824196677337863},
    { 9,  2, 0.7015607600201140098},
    { 9,  7, -1.5309310892394863114},
    { 9, 16, 1.169267933366856683},
    {10,  4, 1.169267933366856683},
    {10, 11, -1.5309310892394863114},
    {10, 22, 0.7015607600201140098},
    {11,  0, 0.67169328938139615748},
    {11,  3, -1.7539019000502850245},
    {11, 10, 1.7539019000502850245},
    {11, 21, -0.67169328938139615748},
    {12,  1, 1.2151388809514737933},
    {12,  6, -1.9764235376052370825},
    {12, 15, 1.2151388809514737933},
};
const static type_sparse_el cptf7[] = {
    { 0,  2, -0.60670333962134435221},
    { 0,  7, -0.31684048566533184861},
    { 0,  9, 1.4169537279434593918},
    { 0, 16, -0.31684048566533184861},
    { 0, 18, 0.82968314787883083417},
    { 0, 20, -1.5208343311935928733},
    { 0, 29, -0.60670333962134435221},
    { 0, 31, 1.4169537279434593918},
    { 0, 33, -1.5208343311935928733},
    { 0, 35, 1.0},
    { 1,  0, -0.41339864235384227977},
    { 1,  3, -0.17963167078872714852},
    { 1,  5, 1.4370533663098171882},
    { 1, 10, -0.13388954226515238921},
    { 1, 12, 0.62718150750531807803},
    { 1, 14, -2.1422326762424382273},
    { 1, 21, -0.1146561540164598136},
    { 1, 23, 0.47901778876993906273},
    { 1, 25, -0.95803557753987812546},
    { 1, 27, 1.4675987714106856141},
    { 2,  1, -0.1146561540164598136},
    { 2,  6, -0.13388954226515238921},
    { 2,  8, 0.47901778876993906273},
    { 2, 15, -0.17963167078872714852},
    { 2, 17, 0.62718150750531807803},
    { 2, 19, -0.95803557753987812546},
    { 2, 28, -0.41339864235384227977},
    { 2, 30, 1.4370533663098171882},
    { 2, 32, -2.1422326762424382273},
    { 2, 34, 1.4675987714106856141},
    { 3,  2, 0.84254721963085980365},
    { 3,  7, 0.14666864502533059662},
    { 3,  9, -1.7491256557036030854},
    { 3, 16, -0.14666864502533059662},
    { 3, 20, 1.4080189922431737275},
    { 3, 29, -0.84254721963085980365},
    { 3, 31, 1.7491256557036030854},
    { 3, 33, -1.4080189922431737275},
    { 4,  4, 0.50807509012231371428},
    { 4, 11, 0.49583051751369852316},
    { 4, 13, -1.3222147133698627284},
    { 4, 22, 0.50807509012231371428},
    { 4, 24, -1.3222147133698627284},
    { 4, 26, 1.6258402883914038857},
    { 5,  0, 0.42961647140211000062},
    { 5,  3, -0.062226236090912312563},
    { 5,  5, -1.2445247218182462513},
    { 5, 10, -0.23190348980538452414},
    { 5, 12, 0.54315511828342602619},
    { 5, 14, 1.2368186122953841287},
    { 5, 21, -0.35746251148251142922},
    { 5, 23, 1.2445247218182462513},
    { 5, 25, -1.6593662957576616683},
    { 6,  1, 0.35746251148251142922},
    { 6,  6, 0.23190348980538452414},
    { 6,  8, -1.2445247218182462513},
    { 6, 15, 0.062226236090912312563},
    { 6, 17, -0.54315511828342602619},
    { 6, 19, 1.6593662957576616683},
    { 6, 28, -0.42961647140211000062},
    { 6, 30, 1.2445247218182462513},
    { 6, 32, -1.2368186122953841287},
    { 7,  2, -0.79037935147039945351},
    { 7,  7, 0.6879369240987588816},
    { 7,  9, 1.025515817677958738},
    { 7, 16, 0.6879369240987588816},
    { 7, 18, -1.8014417303072302517},
    { 7, 29, -0.79037935147039945351},
    { 7, 31, 1.025515817677958738},
    { 8,  4, -0.95323336395336381126},
    { 8, 13, 1.5504341823651057024},
    { 8, 22, 0.95323336395336381126},
    { 8, 24, -1.5504341823651057024},
    { 9,  0, -0.47495887979908323849},
    { 9,  3, 0.61914323168888299344},
    { 9,  5, 0.82552430891851065792},
    { 9, 10, 0.25637895441948968451},
    { 9, 12, -1.8014417303072302517},
    { 9, 21, -0.65864945955866621126},
    { 9, 23, 1.3758738481975177632},
    {10,  1, -0.65864945955866621126},
    {10,  6, 0.25637895441948968451},
    {10,  8, 1.3758738481975177632},
    {10, 15, 0.61914323168888299344},
    {10, 17, -1.8014417303072302517},
    {10, 28, -0.47495887979908323849},
    {10, 30, 0.82552430891851065792},
    {11,  2, 0.67169328938139615748},
    {11,  7, -1.7539019000502850245},
    {11, 16, 1.7539019000502850245},
    {11, 29, -0.67169328938139615748},
    {12,  4, 1.2151388809514737933},
    {12, 11, -1.9764235376052370825},
    {12, 22, 1.2151388809514737933},
    {13,  0, 0.64725984928774934788},
    {13,  3, -1.96875},
    {13, 10, 2.4456993503903949804},
    {13, 21, -1.2566230789301937693},
    {14,  1, 1.2566230789301937693},
    {14,  6, -2.4456993503903949804},
    {14, 15, 1.96875},
    {14, 28, -0.64725984928774934788},
};
const static type_sparse_el cptf8[] = {
    { 0,  0, 0.2734375},
    { 0,  3, 0.13566299095694674896},
    { 0,  5, -1.0853039276555739917},
    { 0, 10, 0.12099545906566282998},
    { 0, 12, -0.56678149117738375672},
    { 0, 14, 1.9359273450506052797},
    { 0, 21, 0.13566299095694674896},
    { 0, 23, -0.56678149117738375672},
    { 0, 25, 1.1335629823547675134},
    { 0, 27, -1.7364862842489183867},
    { 0, 36, 0.2734375},
    { 0, 38, -1.0853039276555739917},
    { 0, 40, 1.9359273450506052797},
    { 0, 42, -1.7364862842489183867},
    { 0, 44, 1.0},
    { 1,  2, -0.84721510698287244363},
    { 1,  7, -0.36813537731583001376},
    { 1,  9, 2.1951352762686132731},
    { 1, 16, -0.27439190953357665914},
    { 1, 18, 0.95803557753987812546},
    { 1, 20, -2.6341623315223359277},
    { 1, 29, -0.23497519304418891392},
    { 1, 31, 0.73171175875620442437},
    { 1, 33, -1.178033207410656044},
    { 1, 35, 1.5491933384829667541},
    { 2,  4, -0.23497519304418891392},
    { 2, 11, -0.27439190953357665914},
    { 2, 13, 0.73171175875620442437},
    { 2, 22, -0.36813537731583001376},
    { 2, 24, 0.95803557753987812546},
    { 2, 26, -1.178033207410656044},
    { 2, 37, -0.84721510698287244363},
    { 2, 39, 2.1951352762686132731},
    { 2, 41, -2.6341623315223359277},
    { 2, 43, 1.5491933384829667541},
    { 3,  0, -0.39218438743784791311},
    { 3,  3, -0.0972889728117695298},
    { 3,  5, 1.459334592176542947},
    { 3, 12, 0.25403754506115685714},
    { 3, 14, -2.3138757483972597747},
    { 3, 21, 0.0972889728117695298},
    { 3, 23, -0.25403754506115685714},
    { 3, 27, 1.5566235649883124768},
    { 3, 36, 0.39218438743784791311},
    { 3, 38, -1.459334592176542947},
    { 3, 40, 2.3138757483972597747},
    { 3, 42, -1.5566235649883124768},
    { 4,  1, -0.20252314682524563222},
    { 4,  6, -0.1967766362666553471},
    { 4,  8, 0.8800118701519835797},
    { 4, 15, -0.1967766362666553471},
    { 4, 17, 0.85880364827689588344},
    { 4, 19, -1.7491256557036030854},
    { 4, 28, -0.20252314682524563222},
    { 4, 30, 0.8800118701519835797},
    { 4, 32, -1.7491256557036030854},
    { 4, 34, 1.7974340685458342478},
    { 5,  2, 0.82265291131801144316},
    { 5,  7, -0.11915417049417047641},
    { 5,  9, -1.7762455001837659611},
    { 5, 16, -0.44406137504594149028},
    { 5, 18, 0.77521709118255285119},
    { 5, 20, 1.4209964001470127689},
    { 5, 29, -0.68448859700003543819},
    { 5, 31, 1.7762455001837659611},
    { 5, 33, -1.9064667279067276225},
    { 6,  4, 0.68448859700003543819},
    { 6, 11, 0.44406137504594149028},
    { 6, 13, -1.7762455001837659611},
    { 6, 22, 0.11915417049417047641},
    { 6, 24, -0.77521709118255285119},
    { 6, 26, 1.9064667279067276225},
    { 6, 37, -0.82265291131801144316},
    { 6, 39, 1.7762455001837659611},
    { 6, 41, -1.4209964001470127689},
    { 7,  0, 0.41132645565900572158},
    { 7,  3, -0.20407507102873838124},
    { 7,  5, -1.2244504261724302874},
    { 7, 10, -0.3033516698106721761},
    { 7, 12, 1.0657473001102595767},
    { 7, 14, 1.2134066792426887044},
    { 7, 21, -0.20407507102873838124},
    { 7, 23, 1.0657473001102595767},
    { 7, 25, -2.1314946002205191534},
    { 7, 36, 0.41132645565900572158},
    { 7, 38, -1.2244504261724302874},
    { 7, 40, 1.2134066792426887044},
    { 8,  1, 0.42481613669916071115},
    { 8,  6, 0.13758738481975177632},
    { 8,  8, -1.4767427774562605828},
    { 8, 15, -0.13758738481975177632},
    { 8, 19, 1.8344984642633570176},
    { 8, 28, -0.42481613669916071115},
    { 8, 30, 1.4767427774562605828},
    { 8, 32, -1.8344984642633570176},
    { 9,  2, -0.76584818175667166625},
    { 9,  7, 0.99833846339806020718},
    { 9,  9, 0.99215674164922147144},
    { 9, 16, 0.41339864235384227977},
    { 9, 18, -2.1650635094610966169},
    { 9, 29, -1.0620403417479017779},
    { 9, 31, 1.6535945694153691191},
    {10,  4, -1.0620403417479017779},
    {10, 11, 0.41339864235384227977},
    {10, 13, 1.6535945694153691191},
    {10, 22, 0.99833846339806020718},
    {10, 24, -2.1650635094610966169},
    {10, 37, -0.76584818175667166625},
    {10, 39, 0.99215674164922147144},
    {11,  0, -0.45768182862115030664},
    {11,  3, 0.79475821795059156217},
    {11,  5, 0.79475821795059156217},
    {11, 12, -2.0752447144854989366},
    {11, 21, -0.79475821795059156217},
    {11, 23, 2.0752447144854989366},
    {11, 36, 0.45768182862115030664},
    {11, 38, -0.79475821795059156217},
    {12,  1, -0.70903764004458888811},
    {12,  6, 0.53582588123382020898},
    {12,  8, 1.4377717134510610478},
    {12, 15, 0.53582588123382020898},
    {12, 17, -2.338535866733713366},
    {12, 28, -0.70903764004458888811},
    {12, 30, 1.4377717134510610478},
    {13,  2, 0.64725984928774934788},
    {13,  7, -1.96875},
    {13, 16, 2.4456993503903949804},
    {13, 29, -1.2566230789301937693},
    {14,  4, 1.2566230789301937693},
    {14, 11, -2.4456993503903949804},
    {14, 22, 1.96875},
    {14, 37, -0.64725984928774934788},
    {15,  0, 0.626706654240043952},
    {15,  3, -2.176535018670731151},
    {15, 10, 3.2353561313826025233},
    {15, 21, -2.176535018670731151},
    {15, 36, 0.626706654240043952},
    {16,  1, 1.2945196985754986958},
    {16,  6, -2.9348392204684739765},
    {16, 15, 2.9348392204684739765},
    {16, 28, -1.2945196985754986958},
};
const static type_sparse_el cptf9[] = {
    { 0,  2, 0.59686501473785067702},
    { 0,  7, 0.29612797475437320937},
    { 0,  9, -1.7657660842403202261},
    { 0, 16, 0.26411138361943717788},
    { 0, 18, -0.92214126273187869253},
    { 0, 20, 2.5354692827465969076},
    { 0, 29, 0.29612797475437320937},
    { 0, 31, -0.92214126273187869253},
    { 0, 33, 1.4846187947947014119},
    { 0, 35, -1.952374120367905548},
    { 0, 46, 0.59686501473785067702},
    { 0, 48, -1.7657660842403202261},
    { 0, 50, 2.5354692827465969076},
    { 0, 52, -1.952374120367905548},
    { 0, 54, 1.0},
    { 1,  0, 0.36685490255855924707},
    { 1,  3, 0.15916400393009351387},
    { 1,  5, -1.5916400393009351387},
    { 1, 10, 0.11811420148091719529},
    { 1, 12, -0.6916059470489090194},
    { 1, 14, 3.1497120394911252077},
    { 1, 21, 0.098709324918124403125},
    { 1, 23, -0.51549263708149354579},
    { 1, 25, 1.3746470322173161221},
    { 1, 27, -3.1586983973799809},
    { 1, 36, 0.088975383089683195547},
    { 1, 38, -0.44144152106008005653},
    { 1, 40, 1.0499040131637084026},
    { 1, 42, -1.4126128673922561809},
    { 1, 44, 1.62697843363992129},
    { 2,  1, 0.088975383089683195547},
    { 2,  6, 0.098709324918124403125},
    { 2,  8, -0.44144152106008005653},
    { 2, 15, 0.11811420148091719529},
    { 2, 17, -0.51549263708149354579},
    { 2, 19, 1.0499040131637084026},
    { 2, 28, 0.15916400393009351387},
    { 2, 30, -0.6916059470489090194},
    { 2, 32, 1.3746470322173161221},
    { 2, 34, -1.4126128673922561809},
    { 2, 45, 0.36685490255855924707},
    { 2, 47, -1.5916400393009351387},
    { 2, 49, 3.1497120394911252077},
    { 2, 51, -3.1586983973799809},
    { 2, 53, 1.62697843363992129},
    { 3,  2, -0.83466307816035426155},
    { 3,  7, -0.2070544267420625878},
    { 3,  9, 2.3149388661875113029},
    { 3, 18, 0.40297913150666282783},
    { 3, 20, -2.9546917977869539993},
    { 3, 29, 0.2070544267420625878},
    { 3, 31, -0.40297913150666282783},
    { 3, 35, 1.7063893769835631924},
    { 3, 46, 0.83466307816035426155},
    { 3, 48, -2.3149388661875113029},
    { 3, 50, 2.9546917977869539993},
    { 3, 52, -1.7063893769835631924},
    { 4,  4, -0.43101816018790287844},
    { 4, 11, -0.4187881980957120927},
    { 4, 13, 1.395960660319040309},
    { 4, 22, -0.4187881980957120927},
    { 4, 24, 1.3623181102386339839},
    { 4, 26, -2.2335370565104644944},
    { 4, 37, -0.43101816018790287844},
    { 4, 39, 1.395960660319040309},
    { 4, 41, -2.2335370565104644944},
    { 4, 43, 1.9703687322875560157},
    { 5,  0, -0.37548796377180986812},
    { 5,  5, 1.4661859659554465543},
    { 5, 10, 0.12089373945199884835},
    { 5, 12, -0.21236437647040795145},
    { 5, 14, -2.417874789039976967},
    { 5, 21, 0.20206443016189559856},
    { 5, 23, -0.79143530297864839268},
    { 5, 25, 1.0552470706381978569},
    { 5, 27, 1.6165154412951647885},
    { 5, 36, 0.27320762396104757397},
    { 5, 38, -1.2199404645272449631},
    { 5, 40, 2.417874789039976967},
    { 5, 42, -2.16878304804843549},
    { 6,  1, -0.27320762396104757397},
    { 6,  6, -0.20206443016189559856},
    { 6,  8, 1.2199404645272449631},
    { 6, 15, -0.12089373945199884835},
    { 6, 17, 0.79143530297864839268},
    { 6, 19, -2.417874789039976967},
    { 6, 30, 0.21236437647040795145},
    { 6, 32, -1.0552470706381978569},
    { 6, 34, 2.16878304804843549},
    { 6, 45, 0.37548796377180986812},
    { 6, 47, -1.4661859659554465543},
    { 6, 49, 2.417874789039976967},
    { 6, 51, -1.6165154412951647885},
    { 7,  2, 0.80430146722719804411},
    { 7,  7, -0.39904527606894581113},
    { 7,  9, -1.7845847267806657796},
    { 7, 16, -0.59316922059788797031},
    { 7, 18, 1.5532816304615888184},
    { 7, 20, 1.4236061294349311288},
    { 7, 29, -0.39904527606894581113},
    { 7, 31, 1.5532816304615888184},
    { 7, 33, -2.5007351860179508607},
    { 7, 46, 0.80430146722719804411},
    { 7, 48, -1.7845847267806657796},
    { 7, 50, 1.4236061294349311288},
    { 8,  4, 0.83067898344030094085},
    { 8, 11, 0.26903627024228973454},
    { 8, 13, -2.1522901619383178764},
    { 8, 22, -0.26903627024228973454},
    { 8, 26, 2.1522901619383178764},
    { 8, 37, -0.83067898344030094085},
    { 8, 39, 2.1522901619383178764},
    { 8, 41, -2.1522901619383178764},
    { 9,  0, 0.39636409043643194293},
    { 9,  3, -0.34393377440500167929},
    { 9,  5, -1.2037682104175058775},
    { 9, 10, -0.29776858550677551679},
    { 9, 12, 1.5691988753163563388},
    { 9, 14, 1.1910743420271020672},
    { 9, 23, 0.64978432507844251538},
    { 9, 25, -2.5991373003137700615},
    { 9, 36, 0.48066206207978815025},
    { 9, 38, -1.6693261563207085231},
    { 9, 40, 1.9851239033785034453},
    {10,  1, 0.48066206207978815025},
    {10,  8, -1.6693261563207085231},
    {10, 15, -0.29776858550677551679},
    {10, 17, 0.64978432507844251538},
    {10, 19, 1.9851239033785034453},
    {10, 28, -0.34393377440500167929},
    {10, 30, 1.5691988753163563388},
    {10, 32, -2.5991373003137700615},
    {10, 45, 0.39636409043643194293},
    {10, 47, -1.2037682104175058775},
    {10, 49, 1.1910743420271020672},
    {11,  2, -0.74463846463549402274},
    {11,  7, 1.2930544805637086353},
    {11,  9, 0.96378590571704436469},
    {11, 18, -2.5166038696554342464},
    {11, 29, -1.2930544805637086353},
    {11, 31, 2.5166038696554342464},
    {11, 46, 0.74463846463549402274},
    {11, 48, -0.96378590571704436469},
    {12,  4, -1.1535889489914915606},
    {12, 11, 0.87177715295353129935},
    {12, 13, 1.7435543059070625987},
    {12, 22, 0.87177715295353129935},
    {12, 24, -2.8358912905407192076},
    {12, 37, -1.1535889489914915606},
    {12, 39, 1.7435543059070625987},
    {13,  0, -0.44314852502786805507},
    {13,  3, 0.96132412415957630049},
    {13,  5, 0.76905929932766104039},
    {13, 10, -0.33291539937855436029},
    {13, 12, -2.3392235702823930554},
    {13, 21, -0.83466307816035426155},
    {13, 23, 2.9059238431784376645},
    {13, 36, 0.75235513151094117345},
    {13, 38, -1.4930907048606177933},
    {14,  1, -0.75235513151094117345},
    {14,  6, 0.83466307816035426155},
    {14,  8, 1.4930907048606177933},
    {14, 15, 0.33291539937855436029},
    {14, 17, -2.9059238431784376645},
    {14, 28, -0.96132412415957630049},
    {14, 30, 2.3392235702823930554},
    {14, 45, 0.44314852502786805507},
    {14, 47, -0.76905929932766104039},
    {15,  2, 0.626706654240043952},
    {15,  7, -2.176535018670731151},
    {15, 16, 3.2353561313826025233},
    {15, 29, -2.176535018670731151},
    {15, 46, 0.626706654240043952},
    {16,  4, 1.2945196985754986958},
    {16, 11, -2.9348392204684739765},
    {16, 22, 2.9348392204684739765},
    {16, 37, -1.2945196985754986958},
    {17,  0, 0.60904939217552380708},
    {17,  3, -2.3781845426185916576},
    {17, 10, 4.1179360680974030877},
    {17, 21, -3.4414040330583097636},
    {17, 36, 1.3294455750836041652},
    {18,  1, 1.3294455750836041652},
    {18,  6, -3.4414040330583097636},
    {18, 15, 4.1179360680974030877},
    {18, 28, -2.3781845426185916576},
    {18, 45, 0.60904939217552380708},
};


typedef struct {
    long size;
    const type_sparse_el *elements;
} type_sparse_tf;


const static type_sparse_tf cptf[MAX_SHELL_TYPE+1] = {
    {1, cptf0}, {3, cptf1}, {8, cptf2}, {16, cptf3}, {28, cptf4}, {46, cptf5},
    {70, cptf6}, {102, cptf7}, {141, cptf8}, {187, cptf9}
};


void cart_to_pure_low(double *work_cart, double* work_pure, long
    shell_type, long stride, long spacing, long count) {

    int c, npure, i;
    const type_sparse_tf* tf;
    const type_sparse_el* el;

    if ((shell_type>MAX_SHELL_TYPE) || (shell_type<0)) {
        throw std::domain_error("The shell type must be in the interval [0,9].");
    }

    npure = 2*shell_type+1;
    tf = &cptf[shell_type];

    for (c=count-1; c>=0; c--) {
        // A) Reset elements in work_pure
        for (i=0; i<npure; i++) {
            work_pure[i*spacing] = 0.0;
        }

        // B) Write linear combinations in work_pure
        el = tf->elements;
        for (i=tf->size-1; i>=0; i--) {
            work_pure[el->ipure*spacing] += el->x*work_cart[el->icart*spacing];
            el++;
        }

        // C) Increment work arrays
        work_pure += stride;
        work_cart += stride;
    }
}
